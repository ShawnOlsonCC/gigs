{% extends "gigs/base.html" %}
{% load thumbnail %}

{% block title %}{{ artist.name }}{% endblock %}
{% block content_title %}{{ artist.name }}{% endblock %}
{% block body_id %}artist{% endblock %}

{% block content_intro %}
	{% with artist.gig_set.select_related.latest as latest_gig %}
		<p>{% if latest_gig.is_finished %}Last spotted in{% else %}Next visiting{% endif %} {{ latest_gig.venue.town }} at {{ latest_gig.venue.name }} on {{ latest_gig.date|date }}.</p>
	{% endwith %}
{% endblock %}

{% block content %}
	<div class="list">
		<h2>Gigs</h2>
		<ol>
			{% for gig in artist.gig_set.published %}
				<li class="vevent{% if gig.is_finished %} finished{% endif %}">
					<a class="url" href="#" title="{{ gig.artist }} at {{ gig.venue }}">
						<span class="location">{{ gig.venue.name|truncatewords:3 }}</span>
						<span class="location">{{ gig.venue.town|truncatewords:3 }}</span>
					</a>
					<abbr class="dtstart" title="{{ gig.date }}">{{ gig.date|date:"jS F Y" }}</abbr>
				</li>
			{% endfor %}
		</ol>
	</div>
	{% if artist.album_set.published %}
		<div class="list">
			<h2>Albums</h2>
			<ol>
				{% for album in artist.album_set.published %}
					<li>
						<a href="http://www.amazon.co.uk/dp/{{ album.asin }}?tag={{ AMAZON_AFFILIATE_TAG }}" title="Buy {{ album.title }} on Amazon">
							{% thumbnail album.cover_art 63x63 crop="0,0" bw upscale as album_cover %}
							<img alt="Cover of {{ album.title }}" height="63" src="{% if album_cover %}{{ album_cover }}{% else %}{{ MEDIA_URL }}gigs/img/default_artist_63x63.jpg{% endif %}" width="63" />
							{{ album.title|truncatewords:3 }}
						</a>
						{% if album.release_date %}<span>{{ album.release_date|date:"Y" }}</span>{% endif %}
					</li>
				{% endfor %}
			</ol>
		</div>
	{% endif %}
	{% if artist.biography_html %}
		<div id="biography_and_photo">
			{% thumbnail artist.photo 340x238 crop="0,0" bw upscale as artist_thumb %}
			<img alt="Photo of {{ artist.name }}" height="238" src="{% if artist_thumb %}{{ artist_thumb }}{% else %}{{ MEDIA_URL }}gigs/img/default_artist_63x63.jpg{% endif %}" width="340" />
			<div id="biography">
				{{ artist.biography_html|safe }}
			</div>
		</div>
	{% endif %}
{% endblock %}
